name: Build RAMSES

on:
  push:
    branches:
      - dev
      - stable
  pull_request:
  workflow_dispatch:

defaults:
  run:
    shell: bash

jobs:
    build:
        name: "${{ matrix.test-type }} in ${{ matrix.ndim }}D"
        runs-on: ubuntu-latest
        strategy:
            matrix:
                test-type: [default, rt, mhd]
                ndim: [1, 2, 3]
                exclude:
                    - test-type: rt
                      ndim: 1
        steps:
        - name: Checkout repository
          uses: actions/checkout@v4
        - name: Install OpenMPI
          run: sudo apt-get install -y openmpi-bin libopenmpi-dev
        - name: Build
          run: bash tests/build.${{ matrix.test-type }}.sh ${{ matrix.ndim }}

    docs:
      runs-on: ${{ matrix.os }}
      strategy:
        fail-fast: false
        matrix:
          os: [ubuntu-latest]
          python-version: ["3.12"]
      steps:
        - uses: actions/checkout@v4

        - name: Set up Python ${{ matrix.python-version }}
          uses: actions/setup-python@v5
          with:
            python-version: ${{ matrix.python-version }}

        - name: Install Pandoc
          run: sudo apt-get install pandoc

        - name: Install RTD requirements
          run: pip install -r doc/rtd_requirements.txt

        - name: Build pdf documentation
          run: sphinx-build -M simplepdf doc doc/_build

        - name: Build html documentation
          run: sphinx-build -M html doc doc/_build
